#!/bin/sh
KEY="-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----";
PIP_REPO="[global]\nindex-url = http://mirrors.aliyun.com/pypi/simple/\ntrusted-host = mirrors.aliyun.com"
CODE_DIR=$1;
REPO_URL=git@gitee.com:ClassmateLin/jd_scripts.git;
REPO_BRANCH=master;

echo "######导入私钥######"
mkdir -p /root/.ssh;
echo -e $KEY > /root/.ssh/id_rsa;
chmod 600 /root/.ssh/id_rsa;

echo "######修改语言编码######"
export LC_ALL="zh_CN.UTF-8";

echo "######拉取项目代码######"
ssh-keyscan gitee.com > /root/.ssh/known_hosts
git clone -b $REPO_BRANCH $REPO_URL $CODE_DIR;

echo "######PIP换源######"
mkdir -p /root/.pip;
echo -e $PIP_REPO > /root/.pip/pip.conf;

echo "######进入项目目录######"
cd $CODE_DIR;
echo "######安装项目依赖#####"
pip install -r ./requirements.txt;

echo "######配置docker-entrypoint文件"
chmod a+x $CODE_DIR/shell/docker-entrypoint.sh
cp $CODE_DIR/shell/docker-entrypoint.sh /